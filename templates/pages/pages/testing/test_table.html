{% extends "layouts/base.html" %}
{% load static %}
{% block content %}
  <h2 style="color: aliceblue" align="center">Stores</h2>
    <h4 style="color: aliceblue" align="center">Select Store</h4>
  <style>
    table {
            background-color: #ece6e6;
            border-collapse: collapse;
            margin-bottom: 20px;
            margin-left: 20px;
            margin-right: 20px;
            width: 98%;
            color: #0a0b0b;
        }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
            background-color: #C21D2b;
            color: #fff;
        }
    td:hover {
      background-color: #eacf4b;
      cursor: pointer;
    }
  </style>

</head>
<body>
  {{ html_table| safe }}
  <script>
    // Get cells in the first column (Name column)
    const cells = document.querySelectorAll('#myTable td:nth-child(3)');

    // Add click event listener to each cell in the first column
    cells.forEach(cell => {
      cell.addEventListener('click', function() {
        // Get row, column index, and cell content
        const rowIndex = this.parentNode.rowIndex;
        const colIndex = this.cellIndex;
        const cellContent = this.textContent;

        // Send data to Django view via AJAX
        fetch('{% url "handle_click" %}', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            // Include CSRF token in production
            // 'X-CSRFToken': getCookie('csrftoken'),
          },
          body: JSON.stringify({
            value: cellContent,
            rowIndex: rowIndex,
            colIndex: colIndex
          })
        })
        .then(response => response.json())
        // .then(data => {
        //   // Display server response (optional)
        //   alert(data.message);
        // })
        // .catch(error => {
        //   console.error('Error:', error);
        //   alert('Error sending data to server');
        // });
      });
    });

    // Function to get CSRF token (uncomment in production)
    /*
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    */
  </script>
</body>
{% endblock content %}
</html>
"""

